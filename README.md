# Compiler-Design
Compiler Design Based on C/C++
# 编译器设计与实现 (Compiler Design)
一个完整的编译器实现项目，支持类Pascal语言的编译，包含完整的编译流程：词法分析、语法分析、语义分析、中间代码生成、代码优化和MIPS目标代码生成。
# 项目特色

- **完整的编译流程**：从源代码到MIPS汇编代码的转换
- **模块化设计**：各编译阶段独立实现，便于理解和维护
- **可视化支持**：语法树可视化输出
- **代码优化**：常量表达式优化和循环优化
- **完整测试**：每个模块都有详细的测试用例
- **错误处理**：完善的错误检测和报告机制

## 项目结构

```
25_complile/
├── 核心编译模块
│   ├── main.cpp              # 主程序入口和文件管理
│   ├── LexicalAnalysis.*     # 词法分析器（状态机实现）
│   ├── syntaxAnalysis.*      # 语法分析器（递归下降）
│   ├── ll1.*                 # LL1语法分析器
│   ├── SemanticAnalysis.*    # 语义分析器（符号表管理）
│   ├── midcode.*             # 中间代码生成器
│   ├── target.*              # MIPS目标代码生成器
│   └── Error_handler.*       # 错误处理模块
├── 代码优化模块
│   ├── betterconst.*         # 常量表达式优化
│   └── betterloop.*          # 循环优化
├── 工具模块  
│   ├── printTree.*           # 语法树打印
│   ├── vis.*                 # 可视化工具
│   └── total.h               # 公共数据结构定义
└── test/                     # 测试用例集合
    ├── 词法分析/             # 词法分析测试
    ├── 语法分析/             # 语法分析测试  
    ├── 语义分析/             # 语义分析测试
    ├── 目标代码/             # 目标代码测试
    └── LL1/                  # LL1分析测试
```

## 功能模块

### 1. 词法分析 (Lexical Analysis)
- **状态机驱动**：基于有限状态自动机的词法识别
- **多种词法单元**：标识符、关键字、常量、操作符、分隔符
- **错误检测**：非法字符、未闭合字符串等错误处理
- **输出格式**：生成token序列供后续分析使用

### 2. 语法分析 (Syntax Analysis) 
- **递归下降分析**：手工构造的递归下降语法分析器
- **LL1文法支持**：支持LL1文法的自动分析
- **语法树构建**：构建抽象语法树(AST)
- **错误恢复**：语法错误的检测和恢复机制

### 3. 语义分析 (Semantic Analysis)
- **符号表管理**：多层次符号表，支持作用域嵌套
- **类型检查**：表达式类型匹配，赋值兼容性检查
- **声明检查**：标识符重复声明、未声明使用检测
- **语义约束**：数组边界检查、参数匹配验证

### 4. 中间代码生成 (Intermediate Code Generation)
- **四元式表示**：使用四元式作为中间表示
- **地址计算**：数组访问、记录字段的地址计算
- **控制流处理**：if-else、while循环的跳转处理
- **过程调用**：参数传递和返回值处理

### 5. 代码优化 (Code Optimization)
- **常量优化**：常量表达式的编译时计算
- **循环优化**：循环不变量外提等优化技术
- **代码化简**：冗余代码消除

### 6. 目标代码生成 (Target Code Generation)
- **MIPS汇编**：生成标准MIPS汇编代码
- **寄存器分配**：简单的寄存器分配策略
- **内存管理**：栈帧布局和变量分配
- **运行时支持**：I/O操作和过程调用的运行时支持

## 编译和运行

### 环境要求
- **编译器**：Visual Studio 2019/2022 
- **标准**：C++17 或更高版本
- **平台**：Windows (项目配置基于Visual Studio)

```

### 输出文件
编译过程会生成多个中间文件：
- `token.txt` - 词法分析结果
- `tree.txt` - 语法树文本表示
- `tree.png` - 语法树可视化图像
- `symboltable.txt` - 符号表内容
- `midcode.txt` - 中间代码
- `mips.asm` - 最终的MIPS汇编代码

## 支持的语言特性

本编译器支持类Pascal语言，包含以下特性：

### 数据类型
- **基本类型**：integer, char, boolean
- **数组类型**：一维和多维数组
- **记录类型**：类似C语言的结构体
- **自定义类型**：类型别名定义

### 控制结构
- **条件语句**：if-then-else, if-then
- **循环语句**：while-endwhile
- **跳转语句**：break, continue

### 过程和函数
- **过程定义**：支持参数传递
- **局部变量**：过程内局部变量声明
- **递归调用**：支持递归过程调用

### 表达式和运算
- **算术运算**：+, -, *, /, mod
- **关系运算**：<, <=, >, >=, =, <>
- **逻辑运算**：and, or, not
- **赋值运算**：:=

### I/O操作
- **输入**：read() 函数
- **输出**：write() 函数

##  测试用例

项目包含完整的测试用例集合，按功能模块分类：

### 词法分析测试
- ✅ 标识符定义错误检测
- ✅ 非法字符处理
- ✅ 未闭合字符串检测
- ✅ 单字符输入错误

### 语法分析测试  
- ✅ 括号匹配检查
- ✅ while-endwhile结构验证
- ✅ 数组声明语法检查
- ✅ 赋值语句语法验证
- ✅ 程序头缺失检测

### 语义分析测试
- ✅ 标识符重复声明检测
- ✅ 未声明标识符使用检查
- ✅ 类型匹配验证
- ✅ 数组下标越界检查
- ✅ 赋值类型兼容性检查

### 目标代码测试
- ✅ 基础代码生成
- ✅ IF语句代码生成
- ✅ 循环结构代码生成
- ✅ 数组操作代码生成
- ✅ 过程调用代码生成
- ✅ 冒泡排序算法实现
- ✅ 常量表达式优化验证

## 使用示例

### 示例程序
```pascal
program example{简单的计算程序}
type t1 = integer;
var integer v1, v2;

procedure calculate(integer i);
var integer result;
begin
    result := i * 2;
    write(result)
end

begin
    read(v1);
    if v1 < 10
    then v1 := v1 + 10; write(v1)
    else v1 := v1 - 10
    fi;
    calculate(v1)
end.
```

### 编译流程
1. **词法分析**：识别关键字、标识符、运算符等
2. **语法分析**：构建语法树，检查语法正确性
3. **语义分析**：类型检查、作用域分析
4. **中间代码生成**：生成四元式中间代码
5. **代码优化**：常量折叠、循环优化
6. **目标代码生成**：生成MIPS汇编代码

##  技术实现

### 核心算法
- **词法分析**：有限状态自动机
- **语法分析**：递归下降 + LL1分析
- **语义分析**：符号表 + 属性文法
- **代码生成**：语法制导翻译

### 数据结构
- **语法树**：多叉树结构存储程序结构
- **符号表**：哈希表实现，支持作用域链
- **四元式**：中间代码的统一表示
- **寄存器池**：简单的寄存器分配管理
